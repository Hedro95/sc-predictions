<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supreme Court Predictions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        h1 {
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        h2 {
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            max-width: 600px;
        }
        
        select {
            flex: 1;
            padding: 12px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: #1e3c72;
        }
        
        button {
            padding: 12px 24px;
            background: #1e3c72;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2a5298;
        }
        
        .table-container {
            overflow-x: auto;
            padding: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: #343a40;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #495057;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 12px 10px;
            text-align: center;
            border: 1px solid #dee2e6;
            min-width: 80px;
            vertical-align: middle;
        }
        
        td:first-child {
            text-align: left;
            font-weight: bold;
            background: #f8f9fa;
            min-width: 200px;
            position: relative;
            padding-right: 40px;
        }
        
        td:nth-child(2) {
            text-align: center;
            font-weight: bold;
            background: #e9ecef;
            min-width: 80px;
            padding: 0;
        }
        
        .guesser-cell {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .guesser-name {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .guesser-name:last-child {
            border-bottom: none;
        }
        
        .remove-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: background 0.2s;
        }
        
        .remove-btn:hover {
            background: #c82333;
        }
        
        td.red {
            background-color: #dc3545;
        }
        
        td.blue {
            background-color: #007bff;
        }
        
        td.clickable {
            cursor: pointer;
            transition: transform 0.2s;
            padding: 0;
        }
        
        .justice-cell {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .vote-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px 1px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .vote-option:last-child {
            border-bottom: none;
        }
        
        .vote-option:hover {
            transform: scale(1.05);
        }
        
        .opinion-cell {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .opinion-input {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .opinion-input:last-child {
            border-bottom: none;
        }
        
        .opinion-input select,
        .opinion-input input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .opinion-input input {
            text-align: center;
        }
        
        .empty-state {
            padding: 40px;
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Big Supreme Court Guesswork Extravaganza: 2025 - 2026</h1>

        <h2>(Red = Plaintiff, Blue = Defendant)</h2>
        
        <div class="controls">
            <div class="input-group">
                <select id="caseSelect">
                    <option value="">Select a case from the 2025-2026 term...</option>
                </select>
                <button onclick="addCase()">Add Case</button>
            </div>
        </div>
        
        <div class="table-container">
            <table id="predictionTable">
                <thead>
                    <tr>
                        <th>Case</th>
                        <th>Guesser</th>
                        <th>Roberts</th>
                        <th>Thomas</th>
                        <th>Alito</th>
                        <th>Sotomayor</th>
                        <th>Kagan</th>
                        <th>Gorsuch</th>
                        <th>Kavanaugh</th>
                        <th>Barrett</th>
                        <th>Jackson</th>
                        <th>Majority</th>
                        <th>Concurrence(s)</th>
                        <th>Dissent(s)</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="empty-state">
                        <td colspan="14">Add a case to begin making predictions!</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

        console.log('Script loaded successfully');

        const firebaseConfig = {
            apiKey: "AIzaSyC9VB2KY5cizlyxkbGLr2XNJQvt9CzIt0A",
            authDomain: "sc-predictions.firebaseapp.com",
            projectId: "sc-predictions",
            storageBucket: "sc-predictions.firebasestorage.app",
            messagingSenderId: "796180462479",
            appId: "1:796180462479:web:6e8a27e0ee94a513d469fa",
            measurementId: "G-LW2KL4X5D3",
            databaseURL: "https://sc-predictions-default-rtdb.firebaseio.com",
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const casesRef = ref(database, 'cases');

        console.log('Firebase initialized', database);

        const justiceCount = 9;
        const justiceNames = ['Roberts', 'Thomas', 'Alito', 'Sotomayor', 'Kagan', 'Gorsuch', 'Kavanaugh', 'Barrett', 'Jackson'];
        
        let isLoading = false;
        
        const cases = [
            "Bowe v. United States",
            "Barrett v. United States",
            "Chiles v. Salazar",
            "Berk v. Choy",
            "Ellingburg v. United States",
            "Villarreal v. Texas",
            "USPS, et al. v. Konan, Lebene",
            "The Hain Celestial Group, Inc. v. Palmquist",
            "Fernandez v. United States",
            "Bost v. Illinois State Board of Elections",
            "Hencely v. Fluor Corporation",
            "Case v. Montana",
            "The GEO Group, Inc. v. Menocal",
            "Hamm v. Smith",
            "Coney Island Auto Parts Unlimited, Inc. v. Burton",
            "Rutherford v. United States",
            "First Choice Women's Resource Centers, Inc. v. Platkin",
            "Chevron USA Inc. v. Plaquemines Parish, Louisiana",
            "Department of Education v. Career Colleges and Schools of Texas",
            "Louisiana v. Callais",
            "Landor v. Louisiana Department of Corrections and Public Safety",
            "M & K Employee Solutions, LLC v. Trustees of the IAM National Pension Fund",
            "Cox Communications, Inc. v. Sony Music Entertainment",
            "FS Credit Opportunities Corp. v. Saba Capital Master Fund, Ltd.",
            "Urias-Orellana v. Bondi",
            "Enbridge Energy, LP v. Nessel",
            "Rico v. United States",
            "National Republican Senatorial Committee v. Federal Election Commission"
        ];
        
        const caseSelect = document.getElementById('caseSelect');
        cases.forEach(caseName => {
            const option = document.createElement('option');
            option.value = caseName;
            option.textContent = caseName;
            caseSelect.appendChild(option);
        });

        // Listen for real-time updates from Firebase
        onValue(casesRef, (snapshot) => {
            isLoading = true;
            const data = snapshot.val();
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            if (data) {
                Object.keys(data).forEach(caseKey => {
                    const caseData = data[caseKey];
                    addCaseRow(caseData.name, caseKey, caseData);
                });
            } else {
                const emptyRow = document.createElement('tr');
                emptyRow.className = 'empty-state';
                const emptyCell = document.createElement('td');
                emptyCell.colSpan = 14;
                emptyCell.textContent = 'Add a case to begin making predictions!';
                emptyRow.appendChild(emptyCell);
                tableBody.appendChild(emptyRow);
            }
            isLoading = false;
        });

        function getCaseKey(caseName) {
            return caseName.replace(/[.#$[\]]/g, '_');
        }

        window.addCase = function() {
            const select = document.getElementById('caseSelect');
            const caseName = select.value;
            
            if (!caseName) {
                alert('Please select a case from the dropdown');
                return;
            }
            
            const caseKey = getCaseKey(caseName);
            const caseRef = ref(database, `cases/${caseKey}`);
            
            set(caseRef, {
                name: caseName,
                votes: Array(justiceCount).fill().map(() => ['blank', 'blank']),
                majority: ['', ''],
                concurrences: ['', ''],
                dissents: ['', '']
            });
            
            select.value = '';
        };

        function addCaseRow(caseName, caseKey, savedData = null) {
            const tableBody = document.getElementById('tableBody');
            
            const row = document.createElement('tr');
            row.dataset.caseKey = caseKey;
            
            const caseCell = document.createElement('td');
            caseCell.textContent = caseName;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'âœ•';
            removeBtn.onclick = function() {
                removeCase(caseKey);
            };
            caseCell.appendChild(removeBtn);
            
            row.appendChild(caseCell);
            
            const guesserCell = document.createElement('td');
            guesserCell.innerHTML = `
                <div class="guesser-cell">
                    <div class="guesser-name">Alex</div>
                    <div class="guesser-name">Joe</div>
                </div>
            `;
            row.appendChild(guesserCell);
            
            for (let i = 0; i < justiceCount; i++) {
                const cell = document.createElement('td');
                cell.className = 'clickable';
                
                const voteDiv = document.createElement('div');
                voteDiv.className = 'justice-cell';
                
                for (let j = 0; j < 2; j++) {
                    const voteOption = document.createElement('div');
                    voteOption.className = 'vote-option';
                    
                    const state = savedData?.votes?.[i]?.[j] || 'blank';
                    voteOption.dataset.state = state;
                    voteOption.dataset.justiceIndex = i;
                    voteOption.dataset.guesserIndex = j;
                    
                    if (state === 'red') {
                        voteOption.style.backgroundColor = '#dc3545';
                    } else if (state === 'blue') {
                        voteOption.style.backgroundColor = '#007bff';
                    }
                    
                    voteOption.onclick = function(e) {
                        e.stopPropagation();
                        cycleState(voteOption, caseKey);
                    };
                    voteDiv.appendChild(voteOption);
                }
                
                cell.appendChild(voteDiv);
                row.appendChild(cell);
            }
            
            const majorityCell = document.createElement('td');
            majorityCell.className = 'clickable';
            const majorityDiv = document.createElement('div');
            majorityDiv.className = 'opinion-cell';
            
            for (let j = 0; j < 2; j++) {
                const majorityInput = document.createElement('div');
                majorityInput.className = 'opinion-input';
                
                const select = document.createElement('select');
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select...';
                select.appendChild(defaultOption);
                
                justiceNames.forEach(justice => {
                    const option = document.createElement('option');
                    option.value = justice;
                    option.textContent = justice;
                    select.appendChild(option);
                });
                
                const perCuriamOption = document.createElement('option');
                perCuriamOption.value = 'Per Curiam';
                perCuriamOption.textContent = 'Per Curiam';
                select.appendChild(perCuriamOption);
                
                if (savedData?.majority?.[j]) {
                    select.value = savedData.majority[j];
                }
                
                select.addEventListener('change', (e) => {
                    if (!isLoading) {
                        updateMajority(caseKey, j, e.target.value);
                    }
                });
                
                majorityInput.appendChild(select);
                majorityDiv.appendChild(majorityInput);
            }
            
            majorityCell.appendChild(majorityDiv);
            row.appendChild(majorityCell);
            
            const concurrenceCell = document.createElement('td');
            concurrenceCell.className = 'clickable';
            const concurrenceDiv = document.createElement('div');
            concurrenceDiv.className = 'opinion-cell';
            
            for (let j = 0; j < 2; j++) {
                const concurrenceInput = document.createElement('div');
                concurrenceInput.className = 'opinion-input';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Enter justices...';
                
                if (savedData?.concurrences?.[j]) {
                    input.value = savedData.concurrences[j];
                }
                
                input.addEventListener('input', (e) => {
                    if (!isLoading) {
                        updateConcurrences(caseKey, j, e.target.value);
                    }
                });
                
                concurrenceInput.appendChild(input);
                concurrenceDiv.appendChild(concurrenceInput);
            }
            
            concurrenceCell.appendChild(concurrenceDiv);
            row.appendChild(concurrenceCell);
            
            const dissentCell = document.createElement('td');
            dissentCell.className = 'clickable';
            const dissentDiv = document.createElement('div');
            dissentDiv.className = 'opinion-cell';
            
            for (let j = 0; j < 2; j++) {
                const dissentInput = document.createElement('div');
                dissentInput.className = 'opinion-input';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Enter justices...';
                
                if (savedData?.dissents?.[j]) {
                    input.value = savedData.dissents[j];
                }
                
                input.addEventListener('input', (e) => {
                    if (!isLoading) {
                        updateDissents(caseKey, j, e.target.value);
                    }
                });
                
                dissentInput.appendChild(input);
                dissentDiv.appendChild(dissentInput);
            }
            
            dissentCell.appendChild(dissentDiv);
            row.appendChild(dissentCell);
            
            tableBody.appendChild(row);
        }
        
        function cycleState(element, caseKey) {
            if (isLoading) return;
            
            const currentState = element.dataset.state;
            let newState;
            
            if (currentState === 'blank') {
                newState = 'red';
                element.style.backgroundColor = '#dc3545';
            } else if (currentState === 'red') {
                newState = 'blue';
                element.style.backgroundColor = '#007bff';
            } else {
                newState = 'blank';
                element.style.backgroundColor = '';
            }
            
            element.dataset.state = newState;
            
            const justiceIndex = parseInt(element.dataset.justiceIndex);
            const guesserIndex = parseInt(element.dataset.guesserIndex);
            
            const caseRef = ref(database, `cases/${caseKey}/votes/${justiceIndex}/${guesserIndex}`);
            set(caseRef, newState);
        }
        
        function updateMajority(caseKey, guesserIndex, value) {
            const caseRef = ref(database, `cases/${caseKey}/majority/${guesserIndex}`);
            set(caseRef, value);
        }
        
        function updateConcurrences(caseKey, guesserIndex, value) {
            const caseRef = ref(database, `cases/${caseKey}/concurrences/${guesserIndex}`);
            set(caseRef, value);
        }
        
        function updateDissents(caseKey, guesserIndex, value) {
            const caseRef = ref(database, `cases/${caseKey}/dissents/${guesserIndex}`);
            set(caseRef, value);
        }
        
        function removeCase(caseKey) {
            const caseRef = ref(database, `cases/${caseKey}`);
            remove(caseRef);
        }
    </script>
</body>
</html>
